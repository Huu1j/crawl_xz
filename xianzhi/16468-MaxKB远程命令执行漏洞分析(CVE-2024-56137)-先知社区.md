# MaxKB远程命令执行漏洞分析(CVE-2024-56137)-先知社区

> **来源**: https://xz.aliyun.com/news/16468  
> **文章ID**: 16468

---

# 漏洞通告

![](images/20250110155043-981a1a34-cf27-1.png)

# 漏洞分析

根据文献了解这个是一个概念漏洞，是模块存在rce，并且1.9.0已经修复了；

关键漏洞触发点在`FunctionExecutor->exec_code`

![](images/20250110155044-987e06dc-cf27-1.png)

\_exec\_code被\_exec\_sandbox调用分析\_exec\_sandbox代码

传递进来的代码段被写入到了py文件里

通过subprocess.run来触发写入py文件的代码段

![](images/20250110155044-98a7650c-cf27-1.png)

exec\_code在debug方法中

可以看到code是通过debug\_instance.get('code')获取的

debug\_instance是通过上层函数传递的继续向上分析

![](images/20250110155044-98dca782-cf27-1.png)

上层是`post`函数调用，`FunctionLibView`类继承了`from rest_framework.views import APIView`，这是一个Django框架，并且是函数的入口点接口是`debug` post请求

![](images/20250110155045-99277b4a-cf27-1.png)

## 路由寻找

查看`urls.py`方法，看到了路由`function_lib/debug`指向`Debug`类，而且使用urls.py文件使用app\_name（空间命名），那么应该还存在一个项目的 URL 配置文件

![](images/20250110155045-9959b15a-cf27-1.png)

全局搜索function\_lib.urls关键字

![](images/20250110155045-998e11a2-cf27-1.png)

目前获取到触发漏洞的url地址是`/api/function_lib/debug`，参数是`code`

# 漏洞复现

根据官方文档搭建环境

登录后台

![](images/20250110155046-99d553c8-cf27-1.png)

点击函数库，并创建函数代码

```
import subprocess

def runcmd():
    cmd = subprocess.run(["whoami"],capture_output=True,text=True)
    return cmd.stdout

```

![](images/20250110155047-9a416324-cf27-1.png)

点击调试，命令执行成功。

![](images/20250110155047-9a79ab94-cf27-1.png)

查看url地址，与推断的url地址一致

![](images/20250110155047-9a9ccf34-cf27-1.png)
