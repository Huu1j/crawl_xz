# GuLoader恶意软件最新攻击链样本详细分析-先知社区

> **来源**: https://xz.aliyun.com/news/16842  
> **文章ID**: 16842

---

# 前言概述

笔者最近逛malware-traffic-analysis网站，发现DBatLoader/GuLoader恶意软件最新攻击链样本，比较有意思，如下所示：

![图片1.png](images/32e1c66b-2633-3162-9544-21366079ba32)

从该网站下载样本之后，对该最新攻击链样本进行了详细分析，分享出来供大家参考学习。

​

# 样本分析

1.初始样本是一个包含CVE-2017-0199漏洞的XLS文件，解析OLE里面的流数据，包含一个URL链接，如下所示：

![图片2.png](images/b929b8f1-c432-3928-af1a-0740b4e224e6)

2.由于漏洞，会自动连接下载URL，URL跳转到另外一个URL链接，并下载对应的HTA恶意脚本文件，如下所示：

![图片3.png](images/49d8db22-4d05-305c-9a44-bb0c93f671f3)

3.下载的HTA恶意脚本，如下所示：

![图片4.png](images/045849f6-a016-3324-874c-2d96a796305d)

4.恶意脚本执行之后，会调用PowerShell执行恶意脚本，恶意脚本的内容，如下所示：

![图片5.png](images/72be4390-bb41-3b68-bb18-f826c9a0e05a)

5.解密PowerShell脚本里面的加密数据，解密之后，该恶意脚本会从远程服务器下载另外一个VBS恶意脚本，如下所示：

![图片6.png](images/b802b9e7-f7d0-3372-bbb5-5db4d703572b)

6.下载的VBS脚本，如下所示：

![图片7.png](images/6856549b-a6b2-3601-924b-fae1d6d4b0ae)

7.解密里面的加密数据代码，解密之后，如下所示：

![图片8.png](images/27dcd938-7712-3a2c-8fbe-311fcb0b45d1)

8.解密之后的PowerShell脚本，会从远程服务器下载一个JPG图片，然后解密里面的加密数据，并加载执行，如下所示：

![图片9.png](images/0a2d0677-a54e-38c7-afd7-bb4d14055fd7)

9.JPG图片中包含的加密数据，如下所示：

![图片10.png](images/82d92dd2-233c-3b84-9e4d-7b8c61ac7c4c)

10.解密该数据之后是一个PayLoad，如下所示：

![图片11.png](images/2427ab06-9d7b-3cf6-b6e9-82b00c584a79)

11.该PayLoad是一个NET程序，样本编译时间为2024年12月13日，如下所示：

![图片12.png](images/7abe7f5f-35d8-3a2b-9006-d1f9ae14ea67)

12.通过分析为一个TaskSchedular程序，如下所示：

![图片13.png](images/45366c0a-7d1b-37c9-a495-2ea8a5f6260f)

开源代码地址：https://github.com/dahall/taskscheduler

13.从远程服务器上下载相关的恶意代码，并加载执行，如下所示：

![图片14.png](images/8157979c-6974-3719-adc8-b44a39328227)

14.通过VIA函数加载下载回来的恶意代码，如下所示：

![图片15.png](images/acfc85c4-0f1f-3c8e-940d-3d8f6c66ddd0)

15.解密远程下载的恶意代码，为一个PayLoad程序，如下所示：

![图片16.png](images/5beea7c0-f853-3fad-ba7d-c1f656ad516b)

16.解密出来的PayLoad对受害者主机进行屏幕记录，如下所示：

![图片17.png](images/cf18338c-657d-3cd8-b0ab-8a173c43afad)

17.屏幕截取记录过程，如下所示：

![图片18.png](images/27542eed-4090-3d15-8999-0952151b0d80)

18.获取主机相关信息，如下所示：

![图片19.png](images/28697aea-dc05-3701-ba62-290685eaa639)

19.进行键盘记录操作，如下所示：

![图片20.png](images/9b001217-f572-36c3-a3a3-c67fca4ab4fe)

20.关闭进程，如下所示：

![图片21.png](images/a2aa7eb9-b0a0-3c3c-a3f2-293bd26e596f)

21.上传受害者信息，到远程FTP服务器，如下所示：

![图片22.png](images/28ed758b-bd26-38de-ace4-b894db357f51)

22.上传到远程FTP服务器过程，如下所示：

![图片23.png](images/307133dc-54c6-3429-8f08-7328c01d882d)

23.远程FTP服务器地址ftp://ftp.horeca-bucuresti.ro，FTP远程服务器的用户名和密码，如下所示：

![图片24.png](images/a1ce5718-5e8d-30e3-b948-b95e6bfc7369)

24.盗取Thunderbird数据库信息，如下所示：

![图片25.png](images/98331202-10ed-38b1-a8fc-d0af54410296)

25.盗取UCBrowser浏览器的登录用户信息，如下所示：

![图片26.png](images/c8f83290-f26b-3684-aa4f-eb4a4749c6dc)

# 威胁情报

![图片27.png](images/09b3225d-9262-3f4c-b976-d45695ee47eb)

# 总结结尾

黑客组织利用各种恶意软件进行的各种攻击活动已经无处不在，防不胜防，很多系统可能已经被感染了各种恶意软件，全球各地每天都在发生各种恶意软件攻击活动，黑客组织一直在持续更新自己的攻击样本以及攻击技术，不断有企业被攻击，这些黑客组织从来没有停止过攻击活动，非常活跃，新的恶意软件层出不穷，旧的恶意软件又不断更新，需要时刻警惕，可能一不小心就被安装了某个恶意软件。
