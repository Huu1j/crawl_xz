# apk修改实践：绕过强制更新弹窗-先知社区

> **来源**: https://xz.aliyun.com/news/16036  
> **文章ID**: 16036

---

本文仅供技术交流

打开app，发现强制更新

![](images/20241207095842-c8e57ec6-b43e-1.png)

强制更新的原理大概是应用在启动时或特定时机，会向服务器请求最新的版本信息，并与本地安装的版本号进行比较。  
要想绕过强制更新的其中一个方法就是修改本地的版本号

使用apk messenger查看一下app信息，发现版本号为7.4.2，而新版本为7.5.1

![](images/20241207100233-52bd90ca-b43f-1.png)

于是接下来就可以尝试把app中为7.4.2的字段改为7.5.1  
改包可以使用mt管理器，不过有些功能要收费。下面说一下免费的方法  
使用jadx反编译apk

![](images/20241207100550-c84e5be4-b43f-1.png)

全局搜索7.4.2

![](images/20241207100727-01c703b2-b440-1.png)  
发现一处是在com.vqs.iphoneassess.BuildConfig中，而com.vqs.iphoneassess会被编译到classes2.dex中

![](images/20241207101118-8b68e018-b440-1.png)  
另一处是在androidmanifest.xml里

![](images/20241207101218-af9e333e-b440-1.png)  
知道要修改位置后，我们可以使用apktool反编译apk

```
java -jar apktool_2.9.0.jar d 你的APK文件路径

```

![](images/20241207101553-2f532904-b441-1.png)

完成后就可以在apktool所在目录下看到生成的文件夹

![](images/20241207101859-9e8fa9c8-b441-1.png)  
先修改AndroidManifest.xml

![](images/20241207101939-b633f4ee-b441-1.png)

![](images/20241207102406-552a67e0-b442-1.png)

再找到buildconfig,

![](images/20241207104250-f39ef628-b444-1.png)

![](images/20241207104318-0446e544-b445-1.png)

将里面的7.4.2修改为7.5.1  
![](images/20241207102430-63f16ac6-b442-1.png)

接着使用Apktool重新打包修改后的文件

```
java -jar apktool_2.9.0.jar b 反编译后的文件夹路径

```

![](images/20241207104845-c6abc85c-b445-1.png)  
这将会在dist目录下生成一个新的APK文件

![](images/20241207104926-df124c04-b445-1.png)

签名apk,使用`jarsigner`工具对APK进行签名。首先，需要生成一个keystore文件，

```
keytool -genkey -v -keystore 新的keystore文件路径 -alias 你的别名 -keyalg RSA -keysize 2048 -validity 10000

```

![](images/20241207105042-0ceea3e8-b446-1.png)

`jarsigner`是Java提供的一个用于签名和验证文件的工具，位于jdk中

![](images/20241207105348-7b4628d4-b446-1.png)

```
jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore 你的keystore文件路径 -storepass 你的keystore密码 -signedjar 签名后的APK文件路径 未签名的APK文件路径 你的keystore别名

```

![](images/20241207105327-6ef63006-b446-1.png)

为了提高安装效率和性能，可以使用`zipalign`工具对APK进行对齐

`zipalign`工具是Android SDK的一部分，用于优化APK文件，确保所有未压缩的数据都以4字节边界对齐，从而提高应用程序的运行效率  
![](images/20241207105559-c962c838-b446-1.png)

```
zipalign -v 4 签名后的APK文件路径 对齐后的APK文件路径

```

![](images/20241207105715-f7084114-b446-1.png)

这样就完成了

下面安装到设备上，打开一看弹窗没了，看看版本发现已经变了

![](images/20241207105956-56dd800e-b447-1.png)
