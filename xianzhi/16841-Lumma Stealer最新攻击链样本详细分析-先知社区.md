# Lumma Stealer最新攻击链样本详细分析-先知社区

> **来源**: https://xz.aliyun.com/news/16841  
> **文章ID**: 16841

---

# 前言概述

Lumma Stealer(又名LummaC2 Stealer)是一种信息窃取程序，自2022年8月起就已通过俄语论坛上的恶意软件即服务(MaaS)模式运营，笔者近日捕获到该家族的最新的攻击链样本，使用Pyramid作为服务器下载恶意软件，对该攻击链样本进行了详细分析，发现有点意思，分享出来供大家参考学习。

​

# 详细分析

1.初始样本为一个短链接，打开之后，会跳转到另外一个网站，如下所示：

![图片1.png](images/6f6c17f1-1a96-38ea-83cf-35635b01dd32)

2.勾选对话框之后会弹出提示，如下所示：

![图片2.png](images/186146ac-19d0-318c-94cc-5e353c240d7e)

3.按上面的指令，会将一段恶意Power Shell脚本复制到CMD命令执行框，如下所示：

![图片3.png](images/702de709-0cba-3412-88e4-40e03c7ed310)

4.恶意Power Shell脚本内容，如下所示：

![图片4.png](images/bf17ff19-5409-329a-a7ca-58f0845c3f3e)

5.从GitHub远程服务器上下载执行另外一段恶意脚本，恶意脚本代码，如下所示：

![图片5.png](images/468b2398-f509-3f55-baf3-204c3785a230)

6.通过Base64解密上面的恶意脚本之后，如下所示：

![图片6.png](images/08577c78-3625-3a21-8b72-f842339a6894)

7.解密出来的恶意脚本会从网上下载python程序压缩包并解压缩，然后会执行另外一段恶意脚本，解密该恶意脚本之后，如下所示：

![图片7.png](images/5a78bb2a-91de-3702-8108-78855f998e9b)

8.恶意脚本会从Drop Box远程服务器上下载另外一段恶意Python代码，如下所示：

![图片8.png](images/5968d25b-03b6-3cbe-af21-eb64d64facc5)

9.下载执行的恶意Python代码，如下所示：

![图片9.png](images/60326d63-c457-305d-bb67-591013c16103)

10.解密上面的Python代码之后，会从Pyramid服务器上下载解密并执行相关的恶意代码，如下所示：

![图片10.png](images/b6b55e41-0d17-3c6b-87fa-c43080879b19)

11.Pyramid服务器的访问帐号和密码信息，如下所示：

![图片11.png](images/4afdb513-126d-3522-a2dc-afabb46aca79)

12.通过解密出来的特定URL链接访问Pyramid服务器，由于分析的时候的该Pyramid服务器已经关闭，笔者在该恶意攻击者的GitHub上找到关联的最新的攻击样本，如下所示：

![图片12.png](images/923c7dfc-10bc-3c8c-a41d-98e611401f4e)

13.跟上面一样，逐层解密里面的恶意脚本之后，会从Drop Box远程服务器上下载一个恶意Python脚本，如下所示：

![图片13.png](images/0c52d43b-26c7-3f58-a513-3399261a2519)

14.下载的恶意Python脚本，与上面类似，如下所示：

![图片14.png](images/490d1d06-1078-3f76-ab00-3234cd49491b)

15.解密上面的Python脚本之后，同样使用Pyramid服务器作为载体，下载执行后面的恶意代码，只是服务器IP变了，如下所示：

![图片15.png](images/15265a68-aedb-30ef-9e20-cd1959eb4616)

16.解密出访问的URL链接，如下所示：

![图片16.png](images/92075fbb-c103-3cc4-b464-c8704c9144de)

17.访问该URL链接，需要脚本中的帐号和密码，然后下载恶意代码，如下所示：

![图片17.png](images/0761eb78-3047-3818-b448-9d5f99837e7e)

18.下载的恶意代码，如下所示：

![图片18.png](images/c123028f-3603-3a18-b7dd-017e3bf4ac7d)

19.再解密从Pyramid服务器下载回来的恶意代码，根据条件选择使用ChaCha20或XOR算法解密，如下所示：

![图片19.png](images/73e36c7a-a3be-38de-9cbb-dc434f3b5f6e)

20.通过分析发现使用ChaCha20算法解密，解密Key和IV包含在脚本中，恶意代码解密之后，是另外一个恶意Python脚本，如下所示：

![图片20.png](images/b3450330-f1ae-3528-bafe-d062fe33bb0b)

21.该恶意脚本同样使用Pyramid服务器作为载体，下载执行后面的恶意代码，先从服务器上下载解密需要的模块，如下所示：

![图片21.png](images/4bf58091-16f9-3eca-9105-13b38c949b11)

22.然后下载解密解压缩需要的windows模块，如下所示：

![图片22.png](images/086c832c-1663-35e6-8ea4-f52a3271ebfa)

23.下载解密解压缩之后，如下所示：

![图片23.png](images/9768af07-bba4-3777-813c-c93009e56157)

24.最后下载解密恶意模块，并通过上面的模块，在内存中加载执行，如下所示：

![图片24.png](images/ea080976-252b-3bf8-8d56-8efb991e4522)

25.下载解密的恶意模块，编译时间为2025年1月12日，如下所示：

![图片25.png](images/5f48aa1b-af0b-3b29-a627-0b243bde9f42)

26.恶意模块，启动rundll32.exe进程，然后将恶意PayLoad注入到进程当中，如下所示：

![图片26.png](images/6dd4122a-aad6-3892-94f5-895b72780205)

27.注入的PayLoad代码，如下所示：

![图片27.png](images/8dfbd4a5-9ffe-3e3a-b5c4-f197ce57f936)

28.PayLoad入口点代码，如下所示：

![图片28.png](images/03c1e07b-78a3-39fa-a896-52558f0ce4fe)

29.里面使用了大量的XOR解密操作，如下所示：

![图片29.png](images/55b75262-dfb7-3ace-85ff-0001a96dcaa8)

30.与此前分析的Lumma Stealer窃密木马相似，解密出来的C2域名为apporholis.shop，如下所示：

![图片30.png](images/dd76052b-5f84-3274-88ce-46c4a2095922)

到此整个Lumma Stealer攻击链样本就分析完毕了，通过使用Pyramid服务器做为服务器载体，然后解密特定的URL和请求头信息，获取加密的数据，再解密执行，有点意思，恶意脚本和二进制样本都使用了多种加密方式来逃避杀毒软件的查杀，目前为止大部分链接已经失效，服务器关闭了，很多样本已经拿不到了，笔者在最短的时间内，通过快速分析拿到了该窃密木马最新的完整的攻击链样本，通过恶意软件威胁情报数据平台显示Lumma Stealer应该是全球最近一两年最流行的窃密木马了，还针对数字货币人员进行过定向的钓鱼攻击，盗取数字货币。

​

# 威胁情报

![图片31.png](images/2b0c818d-f194-39d4-bd4f-9e7cccf57cc6)

# 总结结尾

黑客组织利用各种恶意软件进行的各种攻击活动已经无处不在，防不胜防，很多系统可能已经被感染了各种恶意软件，全球各地每天都在发生各种恶意软件攻击活动，黑客组织一直在持续更新自己的攻击样本以及攻击技术，不断有企业被攻击，这些黑客组织从来没有停止过攻击活动，非常活跃，新的恶意软件层出不穷，旧的恶意软件又不断更新，需要时刻警惕，可能一不小心就被安装了某个恶意软件。
