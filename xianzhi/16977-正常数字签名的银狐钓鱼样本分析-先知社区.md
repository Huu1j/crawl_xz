# 正常数字签名的银狐钓鱼样本分析-先知社区

> **来源**: https://xz.aliyun.com/news/16977  
> **文章ID**: 16977

---

# 前言概述

最近几年“银狐”类黑产团伙非常活跃，今年这些黑产团伙会更加活跃，而且仍然会不断的更新自己的攻击样本，采用各种免杀方式，逃避安全厂商的检测，此前大部分“银狐”黑产团伙使用各种修改版的Gh0st远控作为其攻击武器，远程控制受害者主机之后，进行相关的网络犯罪活动。

针对一款“银狐”钓鱼样本进行了分析，样本是去年12月出现的一批钓鱼样本，如下所示：

![图片1.png](images/7d205547-e41b-3d7e-9edf-b8634fe8723c)

使用正常数字签名是恶意软件经常使用的一种免杀方式之一，该钓鱼样本带有一个正常的数字签名证书，如下所示：

![图片2.png](images/b06954c8-9ada-368e-9239-b82035123eec)

目前该银狐钓鱼样本，国内多家安全厂商均未报毒，样本采用了多种加壳加密方式，同时使用正常的数字签名以逃避安全厂商的检测。

​

# 样本分析

1.母体样本采用C#语言编写，编译时间为2024年11月，使用了混淆加壳技术，如下所示：

![图片3.png](images/09aeac03-5495-313d-8f52-1a93361d91b2)

2.样本被混淆处理，如下所示：

![图片4.png](images/c4f7322d-9eba-3a23-9d24-88f871209ae0)

3.简单使用de4dot工具去混淆，如下所示：

![图片5.png](images/b50759b9-f305-3910-893c-0187a1a5cae9)

4.去混淆之后的代码，如下所示：

![图片6.png](images/70d7c148-cb6d-3cd5-a703-4a2c03a65c52)

5.动态调试解码加密的字符串，如下所示：

![图片7.png](images/9f37400d-1958-3bf9-a7b9-b47d98797b9d)

6.通过Base64解码，如下所示：

![图片8.png](images/a7e442a2-bbc3-303d-a28d-180271058296)

7.解码之后的URL链接，如下所示：

![图片9.png](images/185c3f5b-f493-3845-9088-73a49a6eb6b6)

8.从服务器读取该文件，文件内容，如下所示：

![图片10.png](images/621f1abf-159a-39d4-bebb-1e22c01cac6f)

9.按上面的顺序从远程服务器上下载恶意文件到指定的目录下，如下所示：

![图片11.png](images/186c9dd7-baef-3e0b-95e9-8190f2016638)

10.再启动down.exe程序，如下所示：

![图片12.png](images/f5ed5f40-4afe-35c2-b085-40482fcc84e3)

11.采用白+黑的模式加载恶意模块，如下所示：

![图片13.png](images/3e1f60c2-2ff3-3fdd-aa7d-e4a8c1c7cf32)

12.恶意模块与母体一样也带有正常的数字签名，如下所示：

![图片14.png](images/0a367bb4-cf7e-370f-b148-2a08f7c131a1)

13.恶意模块编译时间为2024年12月16日，使用Virbox加壳处理，如下所示：

![图片15.png](images/08319134-2935-3192-ad76-15a2caad1b2f)

14.读取目录下的加密文件TASLogin.log，如下所示：

![图片16.png](images/2deb0600-9324-3ebd-b04a-11d2e58c67be)

15.分配相应的内存空间，如下所示：

![图片17.png](images/0c54052d-95ed-3689-8e9f-a9c6802b63de)

16.将加密的文件读取到分配的内存空间，如下所示：

![图片18.png](images/bedc3a56-0cfb-39f2-a739-509f665f69b7)

17.解密加密的数据，如下所示：

![图片19.png](images/daded001-49bc-3471-82db-1bcb58ac2ca7)

18.解密之后的ShellCode代码，然后跳转执行到ShellCode代码，如下所示：

![图片20.png](images/11e1a2e6-1650-35e1-ab2c-8e13eb6b808d)

19.ShellCode获取相关函数地址，然后通过VirtualAlloc分配内存空间，如下所示：

![图片21.png](images/8f5876d4-da69-3997-88c5-df3f410cbd19)

20.解密ShellCode中的加密数据，如下所示：

![图片22.png](images/cc5b8137-ab75-379a-a9c4-9e2ef9398f4c)

21.解密之后，如下所示：

![图片23.png](images/1e9af25b-f699-3ff7-8f13-66e11d5a9a42)

22.解密出来的PayLoad采用VMP加壳处理，如下所示：

![图片24.png](images/08110833-5c1f-33bd-b357-c92c73c7c2b8)

23.PayLoad的导出函数，如下所示：

![图片25.png](images/bba9732f-9870-3a54-88b9-0e9e76215171)

24.跳转到PayLoad入口函数，如下所示：

![图片26.png](images/042d8dd0-3ff2-3d6f-a12a-770b6c50c2f8)

25.动态调试在内存加解密出PayLoad，如下所示：

![图片27.png](images/c64579ba-3674-3e80-aabb-c5ce3cc91b3f)

26.该PayLoad为一款远控窃密木马，采用Delphi语言编写，相关的导出函数，如下所示：

![图片28.png](images/c5c3eac0-5912-3c88-bc26-dc22db268935)

27.FJYSA8D1ACE89219943A45570628FEE12787KTAC导出函数代码，如下所示：

![图片29.png](images/b41ef046-5da3-31a8-b466-ecd5732e5e12)

28.盗取受害者浏览器Cookie等数据，包含Chrome、Edge浏览器，如下所示：

![图片30.png](images/ff02b9bb-ec36-3097-9e1e-39803de7ba4e)

29.盗取受害者浏览器登录帐号和密码等数据，如下所示：

![图片31.png](images/1c12942b-10f8-39fa-b020-4e5744d5ec01)

30.通过Chrome扩展程序ID信息等，定位操作系统中存在的数字货币钱包信息，如下所示：

![图片32.png](images/ff6da1e0-8e3c-3f50-a6bb-001c21c284f8)

31.还包含其他多个C2指令，就不一一分析了，如下所示：

![图片33.png](images/7b57bdb7-4bbf-366a-84c3-020b1de71fc2)

32.Stealer远控窃密木马远程服务器C2域名为kimhate.com，如下所示：

![图片34.png](images/ec9c5604-49ed-3fee-bb13-efb41ebe1685)

33.在威胁情报平台查询C2域名，如下所示：

![图片35.png](images/6e72a3ca-80be-3b04-8bc1-d8af9c4c606c)

该PayLoad与此前笔者分析的《伪装成ToDesk安装程序加载后门盗取数字货币》中的PayLoad代码相似度比较高，有可能这个最新的变种样本，有兴趣的可以分析研究一下。

​

# 总结结尾

黑客组织利用各种恶意软件进行的各种攻击活动已经无处不在，防不胜防，很多系统可能已经被感染了各种恶意软件，全球各地每天都在发生各种恶意软件攻击活动，黑客组织一直在持续更新自己的攻击样本以及攻击技术，不断有企业被攻击，这些黑客组织从来没有停止过攻击活动，非常活跃，新的恶意软件层出不穷，旧的恶意软件又不断更新，需要时刻警惕，可能一不小心就被安装了某个恶意软件。
