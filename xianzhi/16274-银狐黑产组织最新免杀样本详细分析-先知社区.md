# 银狐黑产组织最新免杀样本详细分析-先知社区

> **来源**: https://xz.aliyun.com/news/16274  
> **文章ID**: 16274

---

# 前言概述

去年使用“银狐”黑客工具的黑产团伙非常活跃，今年这些黑产团伙仍然非常活跃，而且仍然在不断的更新自己的攻击样本，采用各种免杀方式，逃避安全厂商的检测，使用有效的数字签名证书也是一种很有效的逃避安全软件检测的手段。

近日笔者跟踪捕获到一例使用有效数字签名证书的银狐样本，对该样本母体加载器进行了详细分析，调用函数都被隐藏执行的时候动态获取函数地址，使用了一些加密手法隐藏信息，同时里面有一些反沙箱的操作有点意思，可以看出这个新样本黑产组织又花了一点心思，分享出来供大家参考学习。

# 详细分析

1.样本带有正常的数字签名证书，证书信息，如下所示：  
![](images/20241220080926-accb94b4-be66-1.png)  
2.判断系统是否安装了Telegram应用程序，如下所示：  
![](images/20241220080938-b40003f0-be66-1.png)  
3.如果没有安装，则直接退出，如下所示：  
![](images/20241220080950-bad2a9a8-be66-1.png)  
4.在指定的目录下生成随机文件夹，如下所示：  
![](images/20241220081002-c20ac110-be66-1.png)  
5.从远程服务器上获取相关程序名的配置文件，如下所示：  
![](images/20241220081016-ca798976-be66-1.png)  
6.相关的程序名，如下所示：  
![](images/20241220081029-d208b18a-be66-1.png)  
7.解释配置文件信息，然后从网上去下载对应的文件，如下所示：  
![](images/20241220081044-db5a7e6c-be66-1.png)  
8.从远程服务器上请求对应的文件，相关的URL地址，如下所示：  
![](images/20241220081059-e445eade-be66-1.png)  
9.然后逐个从远程服务器上请求配置信息中的文件，如下所示：  
![](images/20241220081113-ec67f586-be66-1.png)  
10.将请求的文件写入上面生成的随机目录文件夹内，最后生成的文件信息，如下所示：  
![](images/20241220081126-f47a4c60-be66-1.png)  
11.然后再启动目录下的主程序，如下所示：  
![](images/20241220081141-fd15eb68-be66-1.png)  
12.主程序通过白+黑的方式，加载同目录下的恶意模块，如下所示：  
![](images/20241220081153-048f4f9c-be67-1.png)  
13.恶意模块同样带有有效的数字签名证书与母体程序的数字签名证书一样，如下所示：  
![](images/20241220081206-0c364d9a-be67-1.png)  
14.定位到主程序运行目录，如下所示：  
![](images/20241220081218-132345e0-be67-1.png)  
15.解密相关模块的名字，如下所示：  
![](images/20241220081231-1b3fd810-be67-1.png)  
16.通过对比运行程序名来反沙箱操作，如下所示：  
![](images/20241220081244-22b8f4f0-be67-1.png)  
17.通过对比主机名等相关信息来反沙箱操作，如下所示：  
![](images/20241220081256-29fcd8a8-be67-1.png)  
18.通过对比用户名以及主机相关的文件等信息来反沙箱操作，如下所示：  
![](images/20241220081309-31dc943c-be67-1.png)  
19.读取同目录下的mod.data加密数据文件，如下所示：  
![](images/20241220081322-393bd86e-be67-1.png)  
20.将加密的文件数据读取到内存当中，如下所示：  
![](images/20241220081334-4075de90-be67-1.png)  
21.通过VirtualAlloc分配内存空间，如下所示：  
![](images/20241220081347-4817d284-be67-1.png)  
22.解密获取相关中间密钥信息，如下所示：  
![](images/20241220081359-4f868f24-be67-1.png)  
23.解密mod.data的数据之后，如下所示：  
![](images/20241220081412-56e29362-be67-1.png)  
24.解密出来的ShellCode代码，如下所示：  
![](images/20241220081426-5fcbb828-be67-1.png)  
25.跳转到ShellCode代码执行，如下所示：  
![](images/20241220081439-674e0290-be67-1.png)  
26.分配内存空间，将ShellCode中的PayLoad拷贝到分配的内存空间，如下所示：  
![](images/20241220081453-6f7caf66-be67-1.png)  
27.PayLoad相关导出函数，包含后门的安装、加载、执行等操作，如下所示：  
![](images/20241220081506-7762bba8-be67-1.png)  
28.跳转执行到PayLoad的入口函数，如下所示：  
![](images/20241220081520-7f7cc888-be67-1.png)  
29.PayLoad解密出相关的配置信息，如下所示：  
![](images/20241220081533-875bd44a-be67-1.png)  
30.配置信息逆序解码之后，如下所示：  
![](images/20241220081546-8f36a942-be67-1.png)  
后面就是解析C2配置信息等操作，与此前基本一致，从PayLoad的导出函数以及C2配置信息，可以基本确认该样本就是此前银狐样本的最新变种样本。

# 威胁情报

![](images/20241220081613-9f33c9e2-be67-1.png)

# 总结结尾

最近一两年黑产团伙非常活跃，主要通过钓鱼攻击的方式对受害者进行攻击，然后再安装远控后门，控制受害者主机，然后再进行相关的网络犯罪活动，这些黑产组织不断的更新自己的攻击技术，以逃避安全厂商的检测，需要持续关注。
